# ZABBIX

## шаблоны zabbix

При обновлении zabbix шаблоны не обновляются, обновить шаблоны можно вручную:
 [Шаблоны zabbix](https://github.com/zabbix/zabbix/tree/release/5.0/templates)

********************************************************************************

## zabbix agent

Начина с zabbix 4 существеут более совершенный zabbix agent 2, написанный на GO.
[zabbix agent](https://www.zabbix.com/ru/download_agents?version=5.0+LTS&release=5.0.20&os=Windows&os_version=Any&hardware=amd64&encryption=OpenSSL&packaging=MSI&show_legacy=0)

Сущеcтвует два типа агента - активный и пассивный.

**Пассивный** - к агенту zabbix сервер подключается сам и сам запрашивает
 требуемые данные;

**Активный** - агент сам инициализирует подключение к сервреу и передачу данных.
 Но сначала агент должен получить список требуемых данных, которые следует
 пердать. Частота обновления данного списка настраивается параметром
 *RefreshActiveCheck*, и чем реже происходят изменения количества итемсов в
 настройках сервера, тем реже следует выполнять данную проверку.

### авторегистрация узлов сети (активный агент)

#### Настройка на сервере

Используя *активный агент* можно автоматически добавлять новые хосты в мониторинг,
 для этого нужно настроить *авторегистрацию узлов сети*.

Перейдем в *Настройки -> Действия -> Действия Авторегистрации*. Жмем кнопку
 *Создать действие*:

1) **имя** - в поле имя укажем любое имя для нашего действия;
2) **условия** - выберем *"Метаданные узлов сети" -> "Содержит"* и здесь вписываем
    строку по которой будем индентифицировать сервер. За данный параметр отвечает
    ключ в файле настроек zabbix агента **HostMetadata**. Также можно использовать
    параметр **Hostname**.

Далее перейдем на вкладку *Операции* и операции, которые нужно сделать над
 обнаруженным узлом сети, например:

+ Добавить узел сети
+ Добавить в группы узлов сети
+ Присоединить к шаблонам

Жмем кнопку *Добавить*.

Все действия для автоматического обнаружения узлов сети с активным агентом сделаны.
Было создано действые по автоматической регистрации узлов сети с указанными правилами.

#### Настройка zabbix агентов

По умолчанию, если агент устанавливался из архива, zabbix agent 2 ищет конфигурационный
 файл *zabbix_agent2.win.conf* в каталоге с самим агентом.

В файле настроек агента укажем:

1) ServerActive=zabbix_server
    + zabbix сервер к которому подключается zabbix agent 2 для активных проверок
2) HostMetadata=ekp
    + "Метаданные узлов сети", которые мы указали при настройке авторегистрации
    узлов сети.
3) Hostname=host_name
    + уникльное имя узла сети, если не указан, то используется системное имя.
Закоментиреум его, а вместо используем системное имя ПК, указанного в
следующем  в парметре HostnameItem
4) HostnameItem=system.hostname
5) RefreshActiveChecks=3600
    + как часто агент должен обновлять список активных проверок.

Установим zabbix agent 2 как службу:

```cmd
zabbix_agent2.exe --install
```

После чего в службах Windows повится служба *Zabbix agent 2*

Для удаления агента:

```cmd
zabbix_agent2.exe --uninstall
```

Старт агента:

```cmd
zabbix_agent2.exe --start
```

Стоп агента:

```cmd
zabbix_agent2.exe --stop
```

********************************************************************************

## Разное

### Настройки шрифта для карты сетей находятся в файле

    /usr/share/zabbix/js/vector/class.svg.map.js

### Мониторинг запущен ли процесс

```cmd
# zabbix_get -s 10.15.56.5 -k 'proc.num[firefox.exe,admin]'
```
